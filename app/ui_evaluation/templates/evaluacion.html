{% extends "eval_base.html" %}
{% block content %}
<body>

<div class="container-fluid">
    <h2>{{ ecoe.name }}</h2>
    <h3>{{ station.name }}</h3>

    <table class="table table-striped">
        <tr>
            <th>Enunciado</th>
            <th>Referencia</th>
            <th>Opciones</th>
        </tr>
        {% for question in questions %}
          <tr>
            <td>
             {{ loop.index }}.- {{ question.question.description }}
            </td>
            <td>
                {{ question.question.reference }}
            </td>
            <td>
                <div class="form-check">
                {% for option in question.options %}
                    {% if question.question.question_type == 'CH' %}
                        <input type="checkbox" class="form-check-input" name="checkbox{{ question.id }}" id="checkbox{{ question.id }}{{ option.id }}" value="{{ option.points }}" onchange="sendAnswer(this, 1, {{ option.id }})"/>
                        <label class="form-check-label" for="checkbox{{ question.id }}{{ option.id }}">{{ option.label }}</label>
                    {% endif %}
                    {% if question.question.question_type == 'RB' %}
                        <input type="radio" class="form-check-input" name="radiobutton{{ question.id }}" id="radiobutton{{ question.id }}{{ option.id }}" value="{{ option.points }}" onchange="sendAnswer(this, 1, {{ option.id }})">
                        <label class="form-check-label" for="radiobutton{{ question.id }}{{ option.id }}">{{ option.label }}</label>
                    {% endif %}
                {% endfor %}
                </div>
            </td>
          </tr>
        {% endfor %}
    </table>
</div>
</body>
{% endblock %}

{% block scripts %}
    {{ super() }}

    <script>
        function deleteAnswer(id_student, id_option) {
            var delete_url = "{{ url_for('.delete_answer', id_student='.id_student.', id_option='.id_option.') }}"
                .replace('.id_student.', id_student)
                .replace('.id_option.', id_option);

            $.ajax({
                url: delete_url,
                type: 'DELETE',
                success: function(res) {
                    console.log(res)
                }
            });
        }

        function postAnswer(id_student, id_option) {
            var post_url = "{{ url_for('.send_answer', id_student='.id_student.', id_option='.id_option.') }}"
                .replace('.id_student.', id_student)
                .replace('.id_option.', id_option);

            $.ajax({
                url: post_url,
                type: 'POST',
                success: function(result) {
                    console.log(result);
                }
            });
        }

        function sendAnswer(htmlElement, id_student, id_option) {
            console.log(event);

            if (htmlElement.checked) {
                postAnswer(id_student, id_option)
            } else {
                deleteAnswer(id_student, id_option);
            }
        }
    </script>
{% endblock %}
